[gd_scene load_steps=2 format=3 uid="uid://b0w7f0uaxk08b"]

[sub_resource type="GDScript" id="GDScript_n3xil"]
script/source = "extends Node2D

@onready var parent = get_parent()
@onready var moves = parent.MOVES
@onready var ray = $RayCast2D

var push_actions: Node2D
var can_push: bool = false

func _ready():
	if parent.has_node(\"PushActions\"):
		push_actions = parent.get_node(\"PushActions\")
		can_push = true

func move(direction: String) -> void:
	if can_push:
		aim_raycast(direction)
		if ray.is_colliding():
			var node = ray.get_collider()
			push_actions.push(node, direction)
	parent.position += moves[direction] * Globals.GRID_SIZE
	

func is_valid_move(direction: String) -> bool:
	aim_raycast(direction)
	if not ray.is_colliding():
		return true
	elif can_push:
		var collider: Node = ray.get_collider()
		if collider.has_node(\"PushActions\") and collider.has_node(\"MoveActions\"):
				if collider.get_node(\"MoveActions\").is_valid_move(direction):
					return true
	return false
"

[node name="MoveActions" type="Node2D"]
script = SubResource("GDScript_n3xil")
